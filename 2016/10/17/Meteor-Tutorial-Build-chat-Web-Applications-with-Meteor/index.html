	<!DOCTYPE HTML>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  <meta name="google-site-verification" content="B6QNJ8N2Q7hbnMncyrM5GMCWgK-vIAEx0o2DQre64ls">
  
  <title>Meteor Tutorial: Build chat Web Applications with Meteor | t1ger的茶馆</title>
  <meta name="author" content="t1ger">
  
  <meta name="description" content="Meteor tutorial about web Applications">
  

  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta property="og:title" content="Meteor Tutorial: Build chat Web Applications with Meteor">
  <meta property="og:site_name" content="t1ger的茶馆">

  
  
		<!-- favicon -->
		<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
		<link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
		<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
		<link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
		<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
		<link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
		<link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
		<link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
		<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
		<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
		<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
		<link rel="manifest" href="/manifest.json">
		<meta name="msapplication-TileColor" content="#009688">
		<meta name="msapplication-TileImage" content="/mstile-144x144.png">
		<meta name="theme-color" content="#009688">
		<!-- favicon end -->
    <!-- <link href="/favicon.ico" rel="icon"> -->
  

  <!-- toc -->
  <link rel="stylesheet" href="/libs/tocify/jquery.tocify.css" media="screen" type="text/css">

  <!-- <link rel="stylesheet" href="/libs/bs/css/bootstrap.min.css" media="screen" type="text/css"> -->
  <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.min.css" media="screen" type="text/css">

  <!-- material design -->
	<!-- <link rel="stylesheet" href="/libs/bs-material/css/ripples.min.css" media="screen" type="text/css"> -->
  <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/ripples.min.css" media="screen" type="text/css">
  <!-- <link rel="stylesheet" href="/libs/bs-material/css/material.min.css" media="screen" type="text/css"> -->
	<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/material.min.css" media="screen" type="text/css">

  <link rel="stylesheet" href="/css/highlight.light.css" media="screen" type="text/css">

  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">

  

  

  <script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script>
	<script>window.jQuery || document.write('<script src="/libs/jquery-2.0.3.min.js" type="text/javascript"><\/script>')</script>

</head>
</html>
 	<body>
	  <nav class="navbar navbar-default">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">菜单</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">t1ger的茶馆</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
            <ul class="nav navbar-nav navbar-right">
                
                <li>
                    <a href="/" title="">
                    <i class="fa fa-home"></i>首页
                    </a>
                </li>
                
                <li>
                    <a href="/archives" title="">
                    <i class="fa fa-list"></i>存档
                    </a>
                </li>
                
                <li>
                    <a href="/about" title="">
                    <i class="fa fa-info-circle"></i>关于
                    </a>
                </li>
                
                <li>
                    <a href="/atom.xml" title="这是一个订阅源">
                    <i class="fa fa-rss"></i>RSS
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</nav>

	  <div class="container" >
	    <div class="row">
	
	<div class="col-md-9 center-content">
	

		<div class="content">
			<!-- index -->
		   

			  		<h2>Meteor Tutorial: Build chat Web Applications with Meteor</h2>
					
					<div>
						<span class="post-time">2016-10-17 11:46:53</span>
					</div>	
					

					<div class="article-content">
						<p>let’s spent a little time to explain the assessment.first,this is my homework about meteor on coursera.I have to complete three task below</p>
<p>You should download and run the starter application, then test it out by logging in as different users in two different web browsers at the same time, seeing if the users if the users can talk to each other. It creates a set of test user accounts automatically, so you can log in as <a href="mailto:user1@test.com" target="_blank" rel="noopener">user1@test.com</a> … <a href="mailto:user8@test.com" target="_blank" rel="noopener">user8@test.com</a> with the password test123.</p>
<p>Task 1: Improve the look and feel</p>
<p>Adapt the templates and helper functions so that the messaging window displays users’ avatars next to their messages. Feel free to add other enhancements!</p>
<p>Task 2: Implement data writing security</p>
<p>Remove the insecure package from the application and implement a Meteor method to allow the insertion of chat items in the Chats collection. Test that you cannot insert items directly any more.</p>
<p>Task 3: Implement data reading security</p>
<p>Remove the autopublish package from the application and implement publish and subscribe for Chats. Users should only be able to retrieve chats that have their user id in either the user1Id field or the user2Id field. Test by logging in as different users and checking what you can see</p>
<p>Challenge: Implement emoticons</p>
<p>Can you implement emoticon functionality which allows the user to insert graphical emoticons into their message? Emoticons are small icons such as smiley faces which are typical of this kind of application.</p>
<p>this is html file: minstant.html</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;title&gt;minstant&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- this is the main template used by iron:router to build the page --&gt;</span><br><span class="line">&lt;template name=&quot;ApplicationLayout&quot;&gt;</span><br><span class="line">	&#123;&#123;&gt; yield &quot;header&quot;&#125;&#125;</span><br><span class="line">	</span><br><span class="line">	&lt;div class=&quot;container&quot;&gt;</span><br><span class="line">	&#123;&#123;&gt; yield &quot;main&quot;&#125;&#125;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- top level template for the nav bar --&gt;</span><br><span class="line">&lt;template name=&quot;navbar&quot;&gt;</span><br><span class="line">&lt;nav class=&quot;navbar navbar-default&quot;&gt;</span><br><span class="line">  &lt;div class=&quot;container-fluid&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;navbar-header&quot;&gt;</span><br><span class="line">      &lt;a class=&quot;navbar-brand&quot; href=&quot;/&quot;&gt;</span><br><span class="line">        Minstant!</span><br><span class="line">      &lt;/a&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;nav navbar-nav&quot;&gt;</span><br><span class="line">    &#123;&#123;&gt; loginButtons&#125;&#125;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/nav&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- Top level template for the lobby page --&gt;</span><br><span class="line">&lt;template name=&quot;lobby_page&quot;&gt;</span><br><span class="line">	&#123;&#123;&gt; available_user_list&#125;&#125;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- display a list of users --&gt;</span><br><span class="line">&lt;template name=&quot;available_user_list&quot;&gt;</span><br><span class="line">	&lt;h2&gt;Choose someone to chat with:&lt;/h2&gt;</span><br><span class="line">	&lt;div class=&quot;row&quot;&gt;</span><br><span class="line">	&#123;&#123;#each users&#125;&#125;</span><br><span class="line">	&#123;&#123;&gt; available_user&#125;&#125;</span><br><span class="line">	&#123;&#123;/each&#125;&#125;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- display an individual user --&gt;</span><br><span class="line">&lt;template name=&quot;available_user&quot;&gt;</span><br><span class="line">	&lt;div class=&quot;col-md-2&quot;&gt;</span><br><span class="line">		&lt;div class=&quot;user_avatar&quot;&gt;</span><br><span class="line">			&#123;&#123;#if isMyUser _id&#125;&#125; </span><br><span class="line">			&lt;div class=&quot;bg-success&quot;&gt;&#123;&#123;getUsername _id&#125;&#125; (YOU)</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;img src=&quot;/&#123;&#123;profile.avatar&#125;&#125;&quot; class=&quot;avatar_img&quot;&gt;			</span><br><span class="line">			&lt;/div&gt;</span><br><span class="line">			&#123;&#123;else&#125;&#125;</span><br><span class="line">			&lt;a href=&quot;/chat/&#123;&#123;_id&#125;&#125;&quot;&gt;</span><br><span class="line">				&#123;&#123;getUsername _id&#125;&#125;</span><br><span class="line">				&lt;br/&gt;</span><br><span class="line">				&lt;img src=&quot;/&#123;&#123;profile.avatar&#125;&#125;&quot; class=&quot;avatar_img&quot;&gt;</span><br><span class="line">			&lt;/a&gt;</span><br><span class="line">			&#123;&#123;/if&#125;&#125;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- display an individual user avatar --&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!-- Top level template for the chat page --&gt;</span><br><span class="line">&lt;template name=&quot;chat_page&quot;&gt;</span><br><span class="line">	&lt;h2&gt;Type in the box below to send a message!&lt;/h2&gt;</span><br><span class="line">	&lt;div class=&quot;row&quot;&gt;</span><br><span class="line">		&lt;div class=&quot;col-md-12&quot;&gt;</span><br><span class="line">			&lt;div class=&quot;well well-lg&quot;&gt;</span><br><span class="line">			&#123;&#123;#each messages&#125;&#125;</span><br><span class="line"></span><br><span class="line">			&#123;&#123;&gt; chat_message&#125;&#125;</span><br><span class="line">			&#123;&#123;/each&#125;&#125;</span><br><span class="line">			&lt;/div&gt;	</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;row&quot;&gt;</span><br><span class="line">		&lt;div class=&quot;col-md-12&quot;&gt;</span><br><span class="line">			&lt;form class=&quot;js-send-chat&quot;&gt;</span><br><span class="line">			&lt;input class=&quot;input&quot; type=&quot;text&quot; name=&quot;chat&quot; placeholder=&quot;type a message here...&quot;&gt;</span><br><span class="line">			&lt;button class=&quot;btn btn-default&quot;&gt;send&lt;/button&gt;</span><br><span class="line">		&lt;/form&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- simple template that displays a message --&gt;</span><br><span class="line">&lt;template name=&quot;chat_message&quot;&gt;</span><br><span class="line">	&#123;&#123;#if currentUser&#125;&#125; </span><br><span class="line">		&lt;img src=&quot;/&#123;&#123;avatar&#125;&#125;&quot; class=&quot;avatar_img&quot;&gt;&#123;&#123;Username&#125;&#125; said: &#123;&#123;text&#125;&#125;</span><br><span class="line">	&#123;&#123;else&#125;&#125;</span><br><span class="line">		someone said &#123;&#123;text&#125;&#125;</span><br><span class="line">	&#123;&#123;/if&#125;&#125;</span><br><span class="line">	</span><br><span class="line">	&lt;br&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>
<p>this is css file: minstant.css</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/* CSS declarations go here */</span><br><span class="line"></span><br><span class="line">.user_avatar&#123;</span><br><span class="line">	min-height:100px;</span><br><span class="line">	text-align: center;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">.avatar_img&#123;</span><br><span class="line">	height:75px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>this is js file: minstant.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line">Chats = new Mongo.Collection(&quot;chats&quot;);</span><br><span class="line"></span><br><span class="line">if (Meteor.isClient) &#123;</span><br><span class="line">  // set up the main template the the router will use to build pages</span><br><span class="line">  Router.configure(&#123;</span><br><span class="line">    layoutTemplate: &apos;ApplicationLayout&apos;</span><br><span class="line">  &#125;);</span><br><span class="line">  // specify the top level route, the page users see when they arrive at the site</span><br><span class="line">  Router.route(&apos;/&apos;, function () &#123;</span><br><span class="line">    console.log(&quot;rendering root /&quot;);</span><br><span class="line">    this.render(&quot;navbar&quot;, &#123;to:&quot;header&quot;&#125;);</span><br><span class="line">    this.render(&quot;lobby_page&quot;, &#123;to:&quot;main&quot;&#125;);  </span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  // specify a route that allows the current user to chat to another users</span><br><span class="line">  Router.route(&apos;/chat/:_id&apos;, function () &#123;</span><br><span class="line">    // the user they want to chat to has id equal to </span><br><span class="line">    // the id sent in after /chat/... </span><br><span class="line">    var otherUserId = this.params._id;</span><br><span class="line">    // find a chat that has two users that match current user id</span><br><span class="line">    // and the requested user id</span><br><span class="line">    var filter = &#123;$or:[</span><br><span class="line">                &#123;user1Id:Meteor.userId(), user2Id:otherUserId&#125;, </span><br><span class="line">                &#123;user2Id:Meteor.userId(), user1Id:otherUserId&#125;</span><br><span class="line">                ]&#125;;</span><br><span class="line">    var chat = Chats.findOne(filter);</span><br><span class="line">    if (!chat)&#123;// no chat matching the filter - need to insert a new one</span><br><span class="line">      //chatId = Chats.insert(&#123;user1Id:Meteor.userId(), user2Id:otherUserId&#125;);</span><br><span class="line">	  chatId = Meteor.call(&quot;createChat&quot;, Meteor.userId(), otherUserId, function (error) &#123;</span><br><span class="line">      if (error &amp;&amp; error.error === &quot;logged-out&quot;) &#123;</span><br><span class="line">        // show a nice error message</span><br><span class="line">        alert(&quot;Please, log in or create an account.&quot;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;// there is a chat going already - use that. </span><br><span class="line">      chatId = chat._id;</span><br><span class="line">    &#125;</span><br><span class="line">    if (chatId)&#123;// looking good, save the id to the session</span><br><span class="line">      Session.set(&quot;chatId&quot;,chatId);</span><br><span class="line">    &#125;</span><br><span class="line">    this.render(&quot;navbar&quot;, &#123;to:&quot;header&quot;&#125;);</span><br><span class="line">    this.render(&quot;chat_page&quot;, &#123;to:&quot;main&quot;&#125;);  </span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  Meteor.subscribe(&quot;users&quot;);</span><br><span class="line">  Meteor.subscribe(&quot;chats&quot;);</span><br><span class="line"></span><br><span class="line">  ///</span><br><span class="line">  // helper functions </span><br><span class="line">  /// </span><br><span class="line">  Template.available_user_list.helpers(&#123;</span><br><span class="line">    users:function()&#123;</span><br><span class="line">      return Meteor.users.find();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"> Template.available_user.helpers(&#123;</span><br><span class="line">    getUsername:function(userId)&#123;</span><br><span class="line">      user = Meteor.users.findOne(&#123;_id:userId&#125;);</span><br><span class="line">      return user.profile.username;</span><br><span class="line">    &#125;, </span><br><span class="line">    isMyUser:function(userId)&#123;</span><br><span class="line">      if (userId == Meteor.userId())&#123;</span><br><span class="line">        return true;</span><br><span class="line">      &#125;</span><br><span class="line">      else &#123;</span><br><span class="line">        return false;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  Template.chat_page.helpers(&#123;</span><br><span class="line">    messages:function()&#123;</span><br><span class="line">      var chat = Chats.findOne(&#123;_id:Session.get(&quot;chatId&quot;)&#125;);</span><br><span class="line">      return chat.messages;</span><br><span class="line">    &#125;, </span><br><span class="line">    other_user:function()&#123;</span><br><span class="line">      return &quot;&quot;</span><br><span class="line">    &#125;, </span><br><span class="line">	</span><br><span class="line">  &#125;)</span><br><span class="line">    </span><br><span class="line"> Template.chat_page.events(&#123;</span><br><span class="line">  // this event fires when the user sends a message on the chat page</span><br><span class="line">  &apos;submit .js-send-chat&apos;:function(event)&#123;</span><br><span class="line">    // stop the form from triggering a page reload</span><br><span class="line">    event.preventDefault();</span><br><span class="line">    // see if we can find a chat object in the database</span><br><span class="line">    // to which we&apos;ll add the message</span><br><span class="line">    var chat = Chats.findOne(&#123;_id:Session.get(&quot;chatId&quot;)&#125;);</span><br><span class="line">    if (chat)&#123;// ok - we have a chat to use</span><br><span class="line">      var msgs = chat.messages; // pull the messages property</span><br><span class="line">      if (!msgs)&#123;// no messages yet, create a new array</span><br><span class="line">        msgs = [];</span><br><span class="line">      &#125;</span><br><span class="line">      // is a good idea to insert data straight from the form</span><br><span class="line">      // (i.e. the user) into the database?? certainly not. </span><br><span class="line">      // push adds the message to the end of the array</span><br><span class="line">      msgs.push(&#123;text: event.target.chat.value,avatar: Meteor.user().profile.avatar, Username: Meteor.user().profile.username&#125;);</span><br><span class="line">      // reset the form</span><br><span class="line">      event.target.chat.value = &quot;&quot;;</span><br><span class="line">      // put the messages array onto the chat object</span><br><span class="line">      chat.messages = msgs;</span><br><span class="line">      // update the chat object in the database.</span><br><span class="line">	  //Chats.update(chat._id, chat);</span><br><span class="line">	  Meteor.call(&quot;newMessages&quot;, chat._id, chat);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// start up script that creates some users for testing</span><br><span class="line">// users have the username &apos;user1@test.com&apos; .. &apos;user8@test.com&apos;</span><br><span class="line">// and the password test123 </span><br><span class="line"></span><br><span class="line">if (Meteor.isServer) &#123;</span><br><span class="line">  Meteor.startup(function () &#123;</span><br><span class="line">    if (!Meteor.users.findOne())&#123;</span><br><span class="line">      for (var i=1;i&lt;9;i++)&#123;</span><br><span class="line">        var email = &quot;user&quot;+i+&quot;@test.com&quot;;</span><br><span class="line">        var username = &quot;user&quot;+i;</span><br><span class="line">        var avatar = &quot;ava&quot;+i+&quot;.png&quot;</span><br><span class="line">        console.log(&quot;creating a user with password &apos;test123&apos; and username/ email: &quot;+email);</span><br><span class="line">        Meteor.users.insert(&#123;profile:&#123;username:username, avatar:avatar&#125;, emails:[&#123;address:email&#125;],services:&#123; password:&#123;&quot;bcrypt&quot; : &quot;$2a$10$I3erQ084OiyILTv8ybtQ4ON6wusgPbMZ6.P33zzSDei.BbDL.Q4EO&quot;&#125;&#125;&#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; </span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">  Meteor.publish(&quot;chats&quot;,function()&#123;</span><br><span class="line">		return Chats.find(&#123;$or:[</span><br><span class="line">              &#123;user1Id:this.userId&#125;,</span><br><span class="line">              &#123;user2Id:this.userId&#125;</span><br><span class="line">            ]&#125;);</span><br><span class="line"> &#125;);</span><br><span class="line"> </span><br><span class="line"> Meteor.publish(&quot;users&quot;,function()&#123;</span><br><span class="line">	 return Meteor.users.find();</span><br><span class="line"> &#125;); </span><br><span class="line">    </span><br><span class="line"> Meteor.methods(&#123;</span><br><span class="line">	  </span><br><span class="line">  createChat: function (user1, user2) &#123;</span><br><span class="line">          //Check user logged. If no userID throw a Meteor error</span><br><span class="line">    if (!this.userId)&#123;</span><br><span class="line">      throw new Meteor.Error(&quot;logged-out&quot;, &quot;The user must be logged in to post a comment.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // start - createChat</span><br><span class="line">    if (Meteor.users.find(&#123;_id: user1&#125;) &amp;&amp; Meteor.users.find(&#123;_id: user2&#125;)) &#123;</span><br><span class="line">      Chats.insert(&#123;user1Id:user1, user2Id:user2&#125;, function(err, result)&#123;</span><br><span class="line">        if (err) &#123;return err;&#125;</span><br><span class="line">        else &#123;</span><br><span class="line">          return result;&#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, </span><br><span class="line">    //end - createChat</span><br><span class="line">  </span><br><span class="line">	newMessages: function (chatId, messages) &#123;</span><br><span class="line">    Chats.update(chatId, messages);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

							<!-- 支付宝打赏图案 -->
      						<!--
      						<div id="donate_guide" class="donate_bar center ">
          					<a href="http://mypay-1253516637.costj.myqcloud.com/2000.jpg" title="支付宝打赏" class="fancybox" rel="article0"       style="float:left;margin-left:25%;margin-right:2px;">
          					<img src="http://mypay-1253516637.costj.myqcloud.com/2000.jpg" title="支付宝打赏" height="164px" width="164px">
          					</a> 
      						</div>
      						-->
					</div>

			  <!-- about -->
			  
		</div>

		<!-- pagination -->
	  
	  
	    
		<!-- 来必力City版安装代码 -->
<div id="lv-container" data-id="city" data-uid="MTAyMC8zOTQ5MS8xNjAxOA==">
	<script type="text/javascript">
   (function(d, s) {
       var j, e = d.getElementsByTagName(s)[0];

       if (typeof LivereTower === 'function') { return; }

       j = d.createElement(s);
       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
       j.async = true;

       e.parentNode.insertBefore(j, e);
   })(document, 'script');
	</script>
<noscript> 为正常使用来必力评论功能请激活JavaScript</noscript>
</div>
<!-- City版安装代码已完成 -->
		
<!--		<div class="comment-section">
  
  


</div> -->
	</div>

	

</div>


		<footer>
			


<p>
  由 <a href="https://hexo.io">hexo</a> 强力驱动 |&nbsp;&nbsp;本站总点击 <span id="busuanzi_value_site_pv"></span> 次
&nbsp;&nbsp;|&nbsp;&nbsp;您是第 <span id="busuanzi_value_site_uv"></span> 位访客
</p>
<p>
  &copy; 2025 <a href="https://t1ger.github.io"> t1ger </a>
  &nbsp;&nbsp;|&nbsp;&nbsp;<span><a href="/baidusitemap.xml">百度网站地图</a></span>

</p>

<script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

<script>
(function(){
    var bp = document.createElement('script');
    bp.src = '//push.zhanzhang.baidu.com/push.js';
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>

<a id="gotop" href="#" title="back to top"><i class="mdi-hardware-keyboard-arrow-up"></i></a>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-99921399-1', 'auto');
  ga('send', 'pageview');

</script>
		</footer>
	  </div>

		<!-- <script src="/libs/bs/js/bootstrap.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js"></script>
		<script>(typeof $().modal == 'function')|| document.write('<script src="/libs/bs/js/bootstrap.min.js" type="text/javascript"><\/script>')</script>

		<!-- material design -->
		<!-- <script src="/libs/bs-material/js/ripples.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/ripples.min.js"></script>
		<!-- <script src="/libs/bs-material/js/material.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/material.min.js"></script>
		<!-- toc -->
		<!-- <script src="/libs/tocify/jquery-ui.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
		<script src="/libs/tocify/jquery.tocify.custom.js"></script>

		<script src="/js/main.js"></script>

	</body>
</html>
